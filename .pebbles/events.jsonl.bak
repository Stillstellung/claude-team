{"type":"create","timestamp":"2025-12-15T00:33:52.292079Z","issue_id":"cic-une","payload":{"description":"Currently send_message only works FROM coordinator TO workers. Workers have no way to message back to the coordinator because the coordinator doesn't have a session_id in the registry.\n\nProposed solution: Add a 'coordinator inbox' mechanism where:\n1. Workers can call something like send_to_coordinator(message)\n2. Coordinator can poll/read inbox via get_coordinator_messages()\n\nThis would enable async communication patterns without workers writing to temp files.","priority":"2","title":"Add coordinator messaging - allow workers to send messages back to coordinator","type":"feature"}}
{"type":"create","timestamp":"2025-12-15T01:56:09.65449Z","issue_id":"cic-h75","payload":{"description":"Add a Textual-based TUI companion app to claude-team for managing workers, viewing session state, and integrating with beads task tracking. Key features: dual transport (stdio+HTTP), real-time session monitoring, worker spawn/kill, beads task assignment, advisory messages to lead session.","priority":"2","title":"Claude Team TUI Companion App","type":"epic"}}
{"type":"create","timestamp":"2025-12-16T17:20:11.113365Z","issue_id":"cic-l8u","payload":{"description":"Allow claude-team to spawn terminal sessions that do NOT run Claude Code. Useful for long-running shell programs like dev servers (npm run dev), build watchers, database clients, etc. Sessions should be trackable and manageable like Claude sessions but without JSONL/conversation tracking.","priority":"2","title":"Shell-only terminal sessions for long-running processes","type":"epic"}}
{"type":"create","timestamp":"2025-12-16T17:20:34.630863Z","issue_id":"cic-avg","payload":{"description":"Create new MCP tool spawn_shell() similar to spawn_session but without starting Claude. Parameters: project_path, session_name, command (optional - command to run), layout. Should create iTerm window/pane, cd to project, optionally run initial command.","priority":"2","title":"Add spawn_shell MCP tool","type":"task"}}
{"type":"create","timestamp":"2025-12-16T17:20:45.501187Z","issue_id":"cic-q6l","payload":{"description":"Create MCP tool to send commands/input to shell-only sessions. Similar to send_message but for raw shell input. Should handle Enter key properly. May want option to wait for command completion.","priority":"2","title":"Add send_to_shell MCP tool","type":"task"}}
{"type":"create","timestamp":"2025-12-16T17:20:50.891408Z","issue_id":"cic-hr4","payload":{"description":"Create MCP tool to read terminal output from shell-only sessions. Use iTerm2 screen content API (already have this in get_session_status). Return recent lines of output. May want options for line count, follow mode.","priority":"2","title":"Add get_shell_output MCP tool","type":"task"}}
{"type":"create","timestamp":"2025-12-16T17:20:56.307156Z","issue_id":"cic-2q6","payload":{"description":"Ensure spawn_team and layout options work with mixed session types. E.g., quad layout with 3 Claude workers + 1 shell running dev server. May need to extend spawn_team API or add spawn_mixed_team.","priority":"2","title":"Support mixed layouts with shell and Claude sessions","type":"task"}}
{"type":"create","timestamp":"2025-12-16T17:21:01.708275Z","issue_id":"cic-7pt","payload":{"description":"Handle shell session lifecycle: detect if process is still running, graceful shutdown (SIGTERM then SIGKILL), restart capability. Reuse close_session or add close_shell. Add is_process_running check.","priority":"2","title":"Add shell session lifecycle management","type":"task"}}
{"type":"create","timestamp":"2025-12-17T04:38:23.214042Z","issue_id":"cic-x5t","payload":{"description":"Consider adding a close_team() or close_all_sessions() helper for batch closing workers.\n\n**Context from dogfooding:**\nWhen coordinating a team of 4 workers, had to call close_session 4 times sequentially. Minor friction but noticeable.\n\n**Open questions:**\n- Should this close all sessions, or just sessions from a specific spawn_team call?\n- If the latter, need team tracking (see related spike)\n- Is this worth the API surface area or is 4 close calls fine?\n\n**Status:** Thought experiment - not ready to build. Consider independently from main orchestration epic.","priority":"3","title":"Thought experiment: close_team / batch session close","type":"chore"}}
{"type":"create","timestamp":"2025-12-17T04:38:23.497704Z","issue_id":"cic-1vn","payload":{"description":"Consider tracking which workers were spawned together as a 'team'.\n\n**Context from dogfooding:**\nAfter spawning 4 workers, they become individual sessions with no memory that they were spawned together. If I wanted to 'close the team I just spawned' I had to remember which worker IDs belonged to it.\n\n**Possible approaches:**\n1. spawn_team returns a team_id, sessions store it\n2. list_sessions can filter by team_id\n3. close_team(team_id) closes all sessions in that team\n\n**Open questions:**\n- Is this over-engineering? Coordinator could just track IDs themselves\n- Does this conflict with the 'iconic names' approach? (team = name_set used?)\n- What happens if you spawn multiple teams with same name_set?\n\n**Status:** Thought experiment - not ready to build. Consider independently from main orchestration epic.","priority":"3","title":"Thought experiment: team tracking / team_id concept","type":"chore"}}
{"type":"create","timestamp":"2025-12-17T04:42:36.631081Z","issue_id":"cic-bcf","payload":{"description":"Evaluate whether the existing wait_for_completion tool should be kept, modified, or removed.\n\n**Current state:**\n- wait_for_completion exists with 5 min default timeout, polls every 2 seconds\n- Uses multiple detection methods (markers, git, beads, screen, idle time)\n- Unclear if MCP tool timeouts from Claude Code side would even allow 5 min waits\n\n**Concerns:**\n- MCP tool timeout behavior is undocumented\n- Blocking waits don't let coordinator do other work\n- If one worker is slow/blocked, coordinator is stuck\n\n**Alternative pattern (used in dogfooding):**\n- Non-blocking send_message calls\n- Coordinator polls list_sessions / get_conversation_history\n- Coordinator decides when workers are done\n- Each tool call returns quickly, no timeout issues\n\n**Options:**\n1. Keep wait_for_completion as-is (useful for simple single-worker cases?)\n2. Remove it for clarity - polling pattern is safer\n3. Replace with non-blocking check_completion_status\n4. Add wait_for_team that returns when ANY worker finishes (not all)\n\n**Status:** Thought experiment - consider removing existing implementation for clarity.","priority":"3","title":"Thought experiment: wait_for_completion / wait_for_team","type":"chore"}}
{"type":"create","timestamp":"2025-12-21T06:17:51.72494Z","issue_id":"cic-7on","payload":{"description":"Improve the message format returned by read_worker_logs for better coordinator usability.\n\n## Key Improvements\n\n### Add New Fields\n- `index`: Message number in conversation (1-based) for easy reference\n- `time_ago`: Relative timestamp (e.g., '2 min ago') for quick scanning\n- `content_length`: Character count to know message size before reading\n- `content_preview`: First 200 chars for long messages\n- `tools_summary`: List of readable tool summaries (e.g., 'Read → src/foo.py')\n- `tool_count`: Quick count of tools used\n- `has_thinking`: Boolean flag instead of full thinking text by default\n\n### Remove/Simplify\n- Remove `uuid` from default output (noise for coordinators)\n- Simplify `tool_uses` - summarize large inputs instead of full content\n- Replace full `thinking` blocks with boolean flag by default\n\n### Optional Enhancement\n- Consider adding `format` parameter: 'full' (current), 'compact' (previews only), 'summary' (one-line per message)\n\n## Files to Modify\n- src/claude_team_mcp/session_state.py - Message.to_dict() method\n- src/claude_team_mcp/server.py - read_worker_logs tool\n\n## References\nBased on JSONL Conversation Formatting Review research.","priority":"2","title":"Enhance read_worker_logs output formatting","type":"feature"}}
{"type":"create","timestamp":"2025-12-23T04:33:57.891092Z","issue_id":"cic-ivhu","payload":{"description":"When message_workers receives a message that begins with forward slash (/), return immediately despite wait conditions. Interpret this as an attempt at a slash command which doesn't produce reliable telemetry (no stop hook fires). Include in the return that we detected a slash command and recommend the coordinator read the conversation logs to verify success.","priority":"2","title":"Return immediately on slash command messages","type":"feature"}}
{"type":"create","timestamp":"2025-12-23T04:36:31.89944Z","issue_id":"cic-5xot","payload":{"description":"Create a comprehensive terminal abstraction layer that captures full feature parity with both iTerm2 and Zed Terminal CLI backends. The abstraction should be complete and extensible, covering all current and future capabilities.\n\n## Core Features\n- Self-identification (which terminal am I in?)\n- Layout introspection (what panes exist, who are my neighbors?)\n- Splitting panes\n- Spawning new terminals (with or without Claude)\n- Sending text/keys\n- Reading screen content\n- Managing focus\n- Setting titles\n- Layout reorganization\n\n## Advanced Features (iTerm2)\n- Event subscriptions (new session, keystroke, screen update, prompt, location change, custom escape sequences, session terminate, layout change, focus change)\n- Custom control sequences for bidirectional communication\n- Profile customizations (tab colors, badges)\n\n## Advanced Features (Zed)\n- Layout control (TileVertical, TileHorizontal, Consolidate)\n- Layout tree introspection with bounding boxes\n- Move terminal between panes\n- Terminal idle detection\n- in_pane_of targeting for terminal creation","priority":"1","title":"Comprehensive Terminal Abstraction Layer","type":"epic"}}
{"type":"create","timestamp":"2025-12-23T04:37:13.825284Z","issue_id":"cic-bt3a","payload":{"description":"Update existing code in claude_team_mcp to use the new terminal abstraction layer.\n\n## Files to Update\n- server.py - Use TerminalBackend instead of direct iTerm2 connection\n- registry.py - Update ManagedSession to use TerminalHandle\n- tools/*.py - Update all tools to use abstraction\n\n## Migration Strategy\n1. Create TerminalBackend instance in app_lifespan\n2. Update AppContext to hold backend instead of raw connection\n3. Update ensure_connection pattern to work with backend\n4. Migrate iterm_utils.py calls to backend methods\n5. Update ManagedSession to store TerminalHandle instead of iterm_session\n\n## Backwards Compatibility\n- Keep iterm_utils.py as internal implementation detail for now\n- Eventually deprecate direct iterm_utils usage","priority":"2","title":"Migrate existing code to terminal abstraction","type":"task"}}
{"type":"create","timestamp":"2026-01-13T19:23:23.632251Z","issue_id":"cic-d9j","payload":{"description":"When listing or examining workers, the agent_type field (claude vs codex) is not included in the output. Coordinators need this to know which type of worker they're managing.","priority":"2","title":"agent_type not shown in list_workers/examine_worker","type":"bug"}}
{"type":"create","timestamp":"2026-01-13T22:26:56.533366Z","issue_id":"cic-fgx","payload":{"description":"When the MCP server is running inside iTerm2, automatically detect the coordinator's window and prefer spawning workers there (when space is available) before falling back to find_available_window().\n\n## Background\niTerm2 sets ITERM_SESSION_ID in the environment for processes running inside it. We can use this to detect the coordinator's session and find its parent window.\n\n## Implementation\n1. In spawn_workers.py, check os.environ.get('ITERM_SESSION_ID')\n2. If present, use iTerm2 API to look up that session\n3. Use get_window_for_session() to find the coordinator's window\n4. When layout='auto', prefer that window first (if it has space)\n5. Fall back to existing find_available_window() logic if coordinator window is full\n\n## Existing Infrastructure\n- get_window_for_session(app, session) already exists in iterm_utils.py:1098-1117\n- split_pane() supports incremental pane addition\n- find_available_window() handles the general case\n\n## Notes\n- Only affects layout='auto' mode\n- Gracefully degrades if not running in iTerm or window is full\n- No new parameters needed - this is transparent behavior improvement","priority":"2","title":"Auto-detect coordinator's iTerm window and prefer it for spawning workers","type":"feature"}}
{"type":"create","timestamp":"2026-01-13T23:13:50.495475Z","issue_id":"cic-7ni","payload":{"description":"Add name sets featuring famous Romans from antiquity to names.py, covering multiple worker configurations (1, 2, 3, and 4 workers).\n\n## Requirements\n- Add entries to SOLOS, DUOS, TRIOS, QUARTETS dicts in src/claude_team_mcp/names.py\n- Follow existing naming conventions (lowercase keys with underscores)\n- Choose historically notable Romans and groupings","priority":"3","title":"Add famous Romans from antiquity to worker name sets","type":"feature"}}
{"type":"comment","timestamp":"2025-12-15T19:38:22Z","issue_id":"cic-une","payload":{"body":"Author: rabsef-bicrym\nPartial progress: Added get_conversation_history tool (cic-8mk) which allows coordinator to observe worker activity with reverse pagination. This addresses the OBSERVATION part of the problem. The back-channel messaging (workers sending TO coordinator) still needs a queue/inbox system since coordinator isn't in iTerm."}}
{"type":"dep_add","timestamp":"2025-12-16T17:21:17.258226Z","issue_id":"cic-l8u","payload":{"dep_type":"blocks","depends_on":"cic-avg"}}
{"type":"dep_add","timestamp":"2025-12-16T17:21:27.546817Z","issue_id":"cic-l8u","payload":{"dep_type":"blocks","depends_on":"cic-q6l"}}
{"type":"dep_add","timestamp":"2025-12-16T17:21:32.679775Z","issue_id":"cic-l8u","payload":{"dep_type":"blocks","depends_on":"cic-hr4"}}
{"type":"dep_add","timestamp":"2025-12-16T17:21:37.820296Z","issue_id":"cic-l8u","payload":{"dep_type":"blocks","depends_on":"cic-2q6"}}
{"type":"dep_add","timestamp":"2025-12-16T17:21:42.959352Z","issue_id":"cic-l8u","payload":{"dep_type":"blocks","depends_on":"cic-7pt"}}
{"type":"dep_add","timestamp":"2025-12-16T17:21:54.814672Z","issue_id":"cic-q6l","payload":{"dep_type":"blocks","depends_on":"cic-avg"}}
{"type":"dep_add","timestamp":"2025-12-16T17:21:59.958568Z","issue_id":"cic-hr4","payload":{"dep_type":"blocks","depends_on":"cic-avg"}}
{"type":"dep_add","timestamp":"2025-12-16T17:22:05.095812Z","issue_id":"cic-2q6","payload":{"dep_type":"blocks","depends_on":"cic-avg"}}
{"type":"dep_add","timestamp":"2025-12-23T04:37:23.162209Z","issue_id":"cic-5xot","payload":{"dep_type":"blocks","depends_on":"cic-bt3a"}}
{"type":"comment","timestamp":"2026-01-13T23:10:14.082126Z","issue_id":"cic-fgx","payload":{"body":"Close reason: Implemented auto-detect coordinator window with proper ITERM_SESSION_ID parsing and 3-pane layout"}}
{"type":"close","timestamp":"2026-01-13T23:10:14.082126Z","issue_id":"cic-fgx","payload":{}}
{"type":"create","timestamp":"2026-01-20T04:09:10.311493Z","issue_id":"cic-367","payload":{"description":"Abstract claude-team issue tracking so it can work with either Beads (bd) or Pebbles (pb), including detection and prompt/help updates.","priority":"1","title":"Issue tracker abstraction","type":"epic"}}
{"type":"create","timestamp":"2026-01-20T04:09:16.716586Z","issue_id":"cic-90d","payload":{"description":"Add an issue tracker abstraction module with backend registry, command templates, capabilities, and detection (beads vs pebbles).","priority":"1","title":"Phase 1: Issue tracker abstraction module","type":"task"}}
{"type":"create","timestamp":"2026-01-20T04:09:21.078029Z","issue_id":"cic-107","payload":{"description":"Update worktree detection to return tracker-specific env var paths (e.g., BEADS_DIR or Pebbles equivalent).","priority":"1","title":"Phase 2: Worktree detection for tracker env","type":"task"}}
{"type":"create","timestamp":"2026-01-20T04:09:26.691584Z","issue_id":"cic-7c5","payload":{"description":"Replace Beads-specific prompt/help strings with backend data (worker_prompt, constants, bd_help/message hint).","priority":"1","title":"Phase 3: Tracker-neutral prompts and help","type":"task"}}
{"type":"create","timestamp":"2026-01-20T04:09:32.962712Z","issue_id":"cic-a97","payload":{"description":"Update docs and tests to remove Beads-only language and align with the new abstraction.","priority":"2","title":"Phase 4: Tracker-neutral docs and tests","type":"task"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:38.868502Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-90d"}}
{"type":"create","timestamp":"2026-01-20T04:09:41.079133Z","issue_id":"cic-b54","payload":{"description":"Update tests and documentation to be tracker-neutral. Adjust tests/test_worker_prompt.py, CLAUDE.md, README.md, and commands/*.md.","priority":"1","title":"Phase 4: Update docs and tests","type":"task"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:41.09764Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-90d"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:41.116226Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-107"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:41.133989Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-7c5"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:41.16431Z","issue_id":"cic-107","payload":{"dep_type":"blocks","depends_on":"cic-90d"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:41.183647Z","issue_id":"cic-7c5","payload":{"dep_type":"blocks","depends_on":"cic-107"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:44.032047Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-107"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:47.87402Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-7c5"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:51.578675Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-a97"}}
{"type":"close","timestamp":"2026-01-20T04:09:52.39411Z","issue_id":"cic-a97","payload":{}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:52.415024Z","issue_id":"cic-367","payload":{"dep_type":"blocks","depends_on":"cic-b54"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:52.434493Z","issue_id":"cic-b54","payload":{"dep_type":"blocks","depends_on":"cic-7c5"}}
{"type":"dep_add","timestamp":"2026-01-20T04:09:54.91112Z","issue_id":"cic-107","payload":{"dep_type":"blocks","depends_on":"cic-90d"}}
{"type":"dep_add","timestamp":"2026-01-20T04:10:00.488585Z","issue_id":"cic-7c5","payload":{"dep_type":"blocks","depends_on":"cic-107"}}
{"type":"dep_add","timestamp":"2026-01-20T04:10:06.055452Z","issue_id":"cic-a97","payload":{"dep_type":"blocks","depends_on":"cic-7c5"}}
{"type":"status_update","timestamp":"2026-01-20T05:05:20.944388Z","issue_id":"cic-b54","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-20T05:18:20.542131Z","issue_id":"cic-b54","payload":{}}
{"type":"create","timestamp":"2026-01-21T19:06:11.932386Z","issue_id":"cic-c09","payload":{"description":"Three tests in test_cli_backends.py are failing because they expect --full-auto flag but implementation uses --dangerously-bypass-approvals-and-sandbox. Need to investigate which is correct and update either the implementation or tests accordingly.","priority":"2","title":"Fix failing Codex CLI tests","type":"task"}}
{"type":"status_update","timestamp":"2026-01-21T19:06:35.580259Z","issue_id":"cic-c09","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-21T19:08:45.621746Z","issue_id":"cic-c09","payload":{}}
{"type":"create","timestamp":"2026-01-21T19:49:17.679651Z","issue_id":"cic-13e","payload":{"description":"Codex CLI should use --dangerously-bypass-approvals-and-sandbox instead of --full-auto when skip_permissions is requested.","priority":"1","title":"Fix Codex skip permissions flag","type":"bug"}}
{"type":"status_update","timestamp":"2026-01-21T19:49:19.650961Z","issue_id":"cic-13e","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-21T19:50:32.252535Z","issue_id":"cic-13e","payload":{}}
{"type":"create","timestamp":"2026-01-23T21:48:15.471039Z","issue_id":"cic-aef","payload":{"description":"Implement Smart Forking inside claude-team with HTTP-mode indexing, qmd integration, and agent-specific forking for Claude + Codex. Includes background indexing lifecycle, launchd installer, and smart_fork MCP tool. See SMART_FORK_PROPOSAL.md for the detailed requirements and assumptions.","priority":"1","title":"Smart Forking (HTTP, qmd, indexing lifecycle)","type":"epic"}}
{"type":"create","timestamp":"2026-01-23T21:48:44.788243Z","issue_id":"cic-8b0","payload":{"description":"Implement HTTP-only gating and env flags for Smart Fork indexing. Requirements:\n- Indexing only runs when claude-team is in persistent HTTP server mode.\n- Enable via CLAUDE_TEAM_QMD_INDEXING=true.\n- On startup, check prerequisites: qmd on PATH, ~/.claude/projects exists, ~/.codex/sessions exists, ~/.claude-team/index is creatable, and qmd collections can be created/read.\n- If any prerequisite fails, log a clear actionable error and disable indexing; server continues running.\n- Record in logs that smart_fork is unavailable until indexing is enabled/healthy.\n- No retries, caches, or delays beyond the scheduler interval.","priority":"1","title":"Indexing gate + env flags (HTTP-only)","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:48:50.997821Z","issue_id":"cic-641","payload":{"description":"Implement claude-team-owned export of Claude Code session JSONLs to Markdown. Requirements:\n- Source: ~/.claude/projects/\u003cproject-slug\u003e/*.jsonl.\n- Output root: ~/.claude-team/index/claude/.\n- One Markdown file per session id.\n- Normalize header fields: Session ID, Working Directory, Date, Agent (claude), optionally Repo Root.\n- Preserve user/assistant message content; keep format similar to existing claude-sessions markdown exports.\n- Ensure Working Directory is populated from JSONL entries.\n- Avoid extra caching or retries; only skip if output is newer than JSONL.\n- Keep file format stable for qmd parsing and smart_fork metadata extraction.","priority":"1","title":"Claude session markdown export (claude-team owned)","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:48:58.747322Z","issue_id":"cic-37d","payload":{"description":"Implement claude-team-owned export of Codex session JSONLs to Markdown. Requirements:\n- Source: ~/.codex/sessions/**/**/*.jsonl (date-based folders).\n- Use session_meta payload fields: id (session id), cwd (working directory), timestamp.\n- Output root: ~/.claude-team/index/codex/.\n- Normalize headers to match Claude: Session ID, Working Directory, Date, Agent (codex), optionally Repo Root.\n- Preserve user/assistant message content with a stable format for qmd parsing.\n- Ensure exported Session ID matches the id used by `codex fork/resume`.\n- Skip if output is newer than JSONL.\n- No cross-agent forking; codex sessions are only for codex.","priority":"1","title":"Codex session markdown export (claude-team owned)","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:49:05.825511Z","issue_id":"cic-7d9","payload":{"description":"Create/manage qmd collections and run indexing for both agents. Requirements:\n- Collections: claude-sessions -\u003e ~/.claude-team/index/claude, codex-sessions -\u003e ~/.claude-team/index/codex.\n- Bootstrap: create collections if missing, then run qmd update + qmd embed for both.\n- Ongoing: after each export run, call qmd update and qmd embed for the affected collections.\n- Log errors but keep server running (no fatal exit on qmd failure).\n- Keep commands deterministic; no extra caching or retries beyond scheduled runs.","priority":"1","title":"qmd collections + indexing pipeline","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:49:12.615227Z","issue_id":"cic-aad","payload":{"description":"Add a background scheduler for indexing runs when HTTP mode + CLAUDE_TEAM_QMD_INDEXING=true. Requirements:\n- Run initial full sync on startup (non-blocking to HTTP requests).\n- Then schedule periodic refreshes in a background worker.\n- Interval from CLAUDE_TEAM_INDEX_CRON using simple interval strings (e.g., 15m, 1h, 6h); default hourly.\n- Ensure runs do not overlap; if a run is in progress, skip the next trigger.\n- No retries or delays other than the configured interval.","priority":"2","title":"Background indexing scheduler (interval parsing)","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:49:22.368982Z","issue_id":"cic-e08","payload":{"description":"Implement smart_fork MCP tool. Requirements:\n- Input: intent, agent_type (claude|codex, default claude), limit, min_score, include_snippets, auto_fork, fork_index, project_path (optional), collection override (optional).\n- Collection selection: claude -\u003e claude-sessions, codex -\u003e codex-sessions unless explicit collection provided. No cross-agent forking.\n- Search order: qmd query -\u003e vsearch -\u003e search (fallback on error). Include qmd_error + fallback_used in response.\n- Parse Markdown headers: Session ID, Working Directory, Date, Agent (claude|codex). Use Agent header for type.\n- Map to JSONL path: Claude via session_state.get_project_dir, Codex via ~/.codex/sessions/**/\u003csession-id\u003e.jsonl.\n- Enforce current-repo-only: if project_path not provided, default to HTTP server project root; exclude sessions whose working_directory is not inside project_path.\n- On missing qmd/collections: log error, return guidance payload, and include a fallback list of recent sessions (by agent + repo) from JSONL.\n- Optional fork: if auto_fork or fork_index provided, spawn worker using resume/fork semantics for the chosen agent.\n- Output: ranked list with score, snippet, agent_type, working_directory, date, source_path, jsonl_path, and optional forked_session info.","priority":"1","title":"smart_fork MCP tool (qmd search + fork)","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:49:29.962881Z","issue_id":"cic-a3d","payload":{"description":"Extend spawn_workers/WorkerConfig to support resume and fork for both agent types. Requirements:\n- WorkerConfig fields: resume_session_id, fork_session (bool), continue_session (bool), agent_type (claude|codex).\n- Claude: build args with --resume \u003cid\u003e and --fork-session; allow --continue only when explicitly requested.\n- Codex: invoke codex fork \u003cid\u003e for fork_session; codex resume \u003cid\u003e for explicit resume.\n- Ensure no cross-agent mismatches (codex sessions only used with codex agent).\n- Integrate with existing CLI backend abstractions (claude.py, codex.py).\n- Keep behavior additive and isolated; no changes to default spawn behavior unless fields are set.","priority":"1","title":"spawn_workers resume/fork support for Claude + Codex","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:49:35.81704Z","issue_id":"cic-297","payload":{"description":"Provide an installer script that generates and loads a launchd plist for running claude-team in persistent HTTP mode with indexing enabled. Requirements:\n- Script should generate a plist under ~/Library/LaunchAgents and load/unload it (reversible).\n- Plist sets CLAUDE_TEAM_QMD_INDEXING=true and CLAUDE_TEAM_INDEX_CRON interval.\n- Provide a documented example/default config (HTTP port, working directory, env vars).\n- Keep as a small utility in repo (scripts/ or docs/), no external dependencies.","priority":"2","title":"launchd installer for claude-team HTTP mode","type":"task"}}
{"type":"create","timestamp":"2026-01-23T21:49:43.65652Z","issue_id":"cic-232","payload":{"description":"Add basic tests and logging around smart_fork and indexing. Requirements:\n- Unit tests for interval parsing and repo filtering logic.\n- Happy-path tests for qmd command invocation with mocks (query/vsearch/search fallbacks).\n- Logging: indexing start/finish, qmd command failures, smart_fork fallback usage.\n- Avoid snapshotting large outputs; keep tests small and deterministic.","priority":"2","title":"Smart fork/indexing tests + logging","type":"task"}}
{"type":"dep_add","timestamp":"2026-01-23T21:49:48.779034Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-8b0"}}
{"type":"dep_add","timestamp":"2026-01-23T21:49:53.452251Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-641"}}
{"type":"dep_add","timestamp":"2026-01-23T21:49:58.444834Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-37d"}}
{"type":"dep_add","timestamp":"2026-01-23T21:50:02.815238Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-7d9"}}
{"type":"dep_add","timestamp":"2026-01-23T21:50:06.995874Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-aad"}}
{"type":"dep_add","timestamp":"2026-01-23T21:50:14.205421Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-e08"}}
{"type":"dep_add","timestamp":"2026-01-23T21:50:18.306135Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-a3d"}}
{"type":"dep_add","timestamp":"2026-01-23T21:50:23.737545Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-297"}}
{"type":"dep_add","timestamp":"2026-01-23T21:50:29.516671Z","issue_id":"cic-aef","payload":{"dep_type":"blocks","depends_on":"cic-232"}}
{"type":"dep_add","timestamp":"2026-01-23T21:51:51.425922Z","issue_id":"cic-641","payload":{"dep_type":"blocks","depends_on":"cic-8b0"}}
{"type":"dep_add","timestamp":"2026-01-23T21:51:56.219512Z","issue_id":"cic-37d","payload":{"dep_type":"blocks","depends_on":"cic-8b0"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:01.594869Z","issue_id":"cic-7d9","payload":{"dep_type":"blocks","depends_on":"cic-641"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:06.110635Z","issue_id":"cic-7d9","payload":{"dep_type":"blocks","depends_on":"cic-37d"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:10.987387Z","issue_id":"cic-7d9","payload":{"dep_type":"blocks","depends_on":"cic-8b0"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:16.128444Z","issue_id":"cic-aad","payload":{"dep_type":"blocks","depends_on":"cic-7d9"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:22.763806Z","issue_id":"cic-aad","payload":{"dep_type":"blocks","depends_on":"cic-8b0"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:27.010062Z","issue_id":"cic-e08","payload":{"dep_type":"blocks","depends_on":"cic-7d9"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:33.103817Z","issue_id":"cic-e08","payload":{"dep_type":"blocks","depends_on":"cic-a3d"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:38.426629Z","issue_id":"cic-e08","payload":{"dep_type":"blocks","depends_on":"cic-8b0"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:43.505843Z","issue_id":"cic-297","payload":{"dep_type":"blocks","depends_on":"cic-aad"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:48.942468Z","issue_id":"cic-297","payload":{"dep_type":"blocks","depends_on":"cic-8b0"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:53.363731Z","issue_id":"cic-232","payload":{"dep_type":"blocks","depends_on":"cic-e08"}}
{"type":"dep_add","timestamp":"2026-01-23T21:52:58.109017Z","issue_id":"cic-232","payload":{"dep_type":"blocks","depends_on":"cic-aad"}}
{"type":"dep_add","timestamp":"2026-01-23T21:53:04.058789Z","issue_id":"cic-232","payload":{"dep_type":"blocks","depends_on":"cic-a3d"}}
{"type":"status_update","timestamp":"2026-01-23T22:09:37.8467Z","issue_id":"cic-a3d","payload":{"status":"in_progress"}}
{"type":"comment","timestamp":"2026-01-23T22:09:42.675593Z","issue_id":"cic-a3d","payload":{"body":"Completed via cherry-pick commit 91f8fc5 (from worker branch). Added WorkerConfig resume/fork/continue, AgentCLI updates, Claude/Codex CLI integration, validation, and tests (16 new)."}}
{"type":"close","timestamp":"2026-01-23T22:09:51.124417Z","issue_id":"cic-a3d","payload":{}}
{"type":"status_update","timestamp":"2026-01-23T22:15:27.837697Z","issue_id":"cic-8b0","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-24T01:07:36.021417Z","issue_id":"cic-37d","payload":{}}
{"type":"close","timestamp":"2026-01-24T01:30:31.449028Z","issue_id":"cic-641","payload":{}}
{"type":"close","timestamp":"2026-01-24T01:30:54.832995Z","issue_id":"cic-8b0","payload":{}}
{"type":"close","timestamp":"2026-01-24T01:45:26.376769Z","issue_id":"cic-7d9","payload":{}}
{"type":"close","timestamp":"2026-01-24T01:55:54.435888Z","issue_id":"cic-aad","payload":{}}
{"type":"close","timestamp":"2026-01-24T02:30:45.856936Z","issue_id":"cic-232","payload":{}}
{"type":"close","timestamp":"2026-01-24T02:45:38.80895Z","issue_id":"cic-297","payload":{}}
{"type":"create","timestamp":"2026-01-24T19:50:18.476801Z","issue_id":"cic-059","payload":{"description":"When spawning workers with fork_from in a worktree, Claude Code can't find the session because it looks in the worktree's project folder instead of the original project folder.\n\n**Fix:** Before launching Claude with --resume --fork-session, copy the source session file to the worktree's project folder.\n\n**Implementation:**\n1. In spawn_workers, detect fork_from parameter\n2. Compute source project folder (from main repo path) \n3. Compute target project folder (from worktree path)\n4. Copy {session_id}.jsonl from source to target\n5. Then launch Claude as normal\n\n~10 lines of Python.","priority":"2","title":"Fix fork_from session lookup for worktrees","type":"bug"}}
{"type":"status_update","timestamp":"2026-01-24T19:52:25.775255Z","issue_id":"cic-059","payload":{"status":"closed"}}
{"type":"create","timestamp":"2026-01-27T01:24:22.838055Z","issue_id":"cic-d86","payload":{"description":"## Summary\nAdd HTTP endpoints for workers to send structured messages to the coordinator in real-time.\n\n## Motivation\nWorkers need a way to report progress, findings, errors, and completion status. Currently there's no standardized communication channel. Since claude-team runs as an HTTP server (streamable HTTP MCP), we can expose inbox endpoints.\n\n## Proposed Endpoints\n\n```\nPOST /inbox\n  Body: {\"worker\": \"SecurityAudit\", \"type\": \"progress\", \"pct\": 75, ...}\n  → Appends to worker's message queue\n\nGET /inbox\n  ?worker=X (optional filter)\n  → Returns messages, optionally mark as read\n\nGET /inbox/{worker}/unread\n  → Count of unread messages (for status display)\n```\n\n## Worker Environment\nWhen spawning workers, inject:\n```bash\nexport CT_INBOX_URL=\"http://localhost:PORT/inbox\"\nexport CT_WORKER_NAME=\"WorkerName\"\n```\n\nWorkers can then:\n```bash\ncurl -sX POST \"$CT_INBOX_URL\" -d '{\"worker\":\"$CT_WORKER_NAME\",\"type\":\"done\"}'\n```\n\n## Benefits\n- Real-time delivery (no polling files)\n- HTTP server already running\n- Works from any language/CLI\n- Enables automation based on message types","priority":"2","title":"HTTP Inbox for worker → coordinator messaging","type":"task"}}
{"type":"create","timestamp":"2026-01-27T01:24:32.601475Z","issue_id":"cic-9fa","payload":{"description":"## Summary\nDefine standardized message types for worker → coordinator communication via the inbox system.\n\n## Motivation\nWithout structure, coordinator has to parse free-form text. Structured messages enable:\n- Progress tracking (UI shows \"Worker A: 60% complete\")\n- Error classification (rate_limit vs auth_failed)\n- Task handoff between workers\n- Auto-cleanup on completion\n- Metrics and analytics\n\n## Proposed Message Types\n\n```json\n// Progress update\n{\"type\": \"progress\", \"pct\": 50, \"msg\": \"analyzing auth module\"}\n\n// Blocked/waiting\n{\"type\": \"blocked\", \"reason\": \"need API key\", \"waiting_for\": \"coordinator\"}\n\n// Findings/output\n{\"type\": \"findings\", \"summary\": \"found 3 issues\", \"details\": [...], \"output_file\": \"/tmp/report.md\"}\n\n// Task complete\n{\"type\": \"done\", \"summary\": \"implemented feature X\", \"commits\": [\"abc123\"]}\n\n// Error\n{\"type\": \"error\", \"kind\": \"rate_limit\", \"msg\": \"hit API limit, backing off\"}\n\n// Status heartbeat\n{\"type\": \"heartbeat\", \"status\": \"running\", \"current_task\": \"writing tests\"}\n```\n\n## Schema\nAll messages have:\n- `type` (required): message type\n- `ts` (auto-added): ISO timestamp\n- `worker` (from env): worker name\n\n## Notes\n- Serves as abstraction layer across different agent backends (codex, claude, gemini)\n- Enables coordinator to take automated actions based on message type\n- JSON schema validation optional but recommended","priority":"2","title":"Structured message types for worker communication","type":"task"}}
{"type":"create","timestamp":"2026-01-27T01:24:41.892732Z","issue_id":"cic-335","payload":{"description":"## Summary\nSupport user-defined agent profiles that specify CLI backend, model, and prompt presets.\n\n## Motivation\nCurrently `agent_type` is limited to `codex` or `claude`. Users want to:\n- Define reusable personas (security-reviewer, rails-expert, etc.)\n- Use different CLI backends (gemini, opencode, future agents)\n- Preset system prompts and model preferences\n\n## Proposed Schema\n\n```yaml\n# ~/.claude-team/agents/security-reviewer.yaml\nname: security-reviewer\ncli: claude                    # claude | codex | gemini\nmodel: sonnet                  # model flag for that CLI\nsystem_prompt: |\n  You are a security expert. Focus on:\n  - Authentication vulnerabilities\n  - Input validation\n  - SQL injection, XSS, CSRF\ndefault_flags:\n  - \"--dangerously-skip-permissions\"\n```\n\n## Usage\n\n```python\nspawn_workers([{\n    \"agent_profile\": \"security-reviewer\",  # loads ~/.claude-team/agents/security-reviewer.yaml\n    \"prompt\": \"Review the auth module\"\n}])\n```\n\nOr override parts:\n```python\nspawn_workers([{\n    \"agent_profile\": \"security-reviewer\",\n    \"model\": \"opus\",  # override model\n    \"prompt\": \"...\"\n}])\n```\n\n## Built-in Profiles\nShip with sensible defaults:\n- `researcher` - read-only exploration\n- `implementer` - full access, code changes\n- `reviewer` - read + analysis focused\n\n## Discovery\n```\nct profiles list\nct profiles show security-reviewer\n```","priority":"2","title":"Plugin agent profiles (reusable agent configurations)","type":"task"}}
{"type":"create","timestamp":"2026-01-27T01:24:49.578989Z","issue_id":"cic-bb6","payload":{"description":"## Summary\nAutomatically commit pebbles events.jsonl before creating worktrees so workers can see assigned issues.\n\n## Problem\nWhen coordinator creates issues and then spawns workers in worktrees, workers can't see the issues because they're not committed yet.\n\n## Proposed Solution\nIn spawn_workers, before creating worktree:\n\n```python\n# If main repo has uncommitted pebbles changes\nif has_uncommitted_pebbles(main_repo):\n    subprocess.run([\"git\", \"add\", \".pebbles/events.jsonl\"], cwd=main_repo)\n    subprocess.run([\"git\", \"commit\", \"-m\", \"pebbles: sync before spawn\"], cwd=main_repo)\n```\n\n## Notes\n- Depends on pb-6a0 (pb sync command in pebbles repo) OR implement inline\n- Only commits pebbles file, not other changes\n- Could be opt-out via flag if user doesn't want auto-commit\n- After worktree created, worker sees all issues","priority":"2","title":"Auto-commit pebbles before spawning workers in worktrees","type":"task"}}
{"type":"create","timestamp":"2026-01-27T20:42:49.042737Z","issue_id":"cic-023","payload":{"description":"Add project_filter parameter to list_workers MCP tool to filter by project path/basename/partial match; update team-status.sh --project.","priority":"2","title":"Add project filter to list_workers","type":"task"}}
{"type":"rename","timestamp":"2026-01-27T20:42:51.792118Z","issue_id":"cic-023","payload":{"new_id":"cic-b3c"}}
{"type":"status_update","timestamp":"2026-01-27T20:42:53.464671Z","issue_id":"cic-b3c","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-27T20:47:28.975031Z","issue_id":"cic-b3c","payload":{}}
{"type":"create","timestamp":"2026-01-27T21:48:30.250806Z","issue_id":"cic-e18","payload":{"description":"Add background asyncio task to HTTP server that periodically snapshots worker state.\n\n## Location\nsrc/claude_team/poller.py (new file)\nIntegration in src/claude_team/mcp_server.py\n\n## Requirements\n- WorkerPoller class with start/stop methods\n- Snapshot workers every 60s\n- Diff snapshots to detect state transitions (started/idle/active/closed)\n- Write events to event log (use events.py module)\n- Emit full snapshot every 5 minutes for recovery\n\n## Integration\n- Start poller on HTTP server startup\n- Stop gracefully on shutdown\n\n## Dependencies\nUses cic-d0d (events.py) and cic-116 (idle_detection.py)","priority":"1","title":"Background poller for worker state snapshots","type":"task"}}
{"type":"create","timestamp":"2026-01-27T21:48:38.868204Z","issue_id":"cic-467","payload":{"description":"Add new MCP tool to query worker state changes since last poll.\n\n## Location\nsrc/claude_team/mcp_server.py (add to existing tools)\n\n## Tool Signature\npoll_worker_changes(\n    since: str | None = None,\n    stale_threshold_minutes: int = 20,\n    include_snapshots: bool = False,\n) -\u003e dict\n\n## Returns\n{\n    'events': [...],  # Raw events if requested\n    'summary': {\n        'completed': [{'name': '...', 'bead': '...', 'duration_min': N}],\n        'stuck': [{'name': '...', 'inactive_minutes': N}],\n        'started': [{'name': '...', 'project': '...'}],\n    },\n    'active_count': N,\n    'idle_count': N,\n    'poll_ts': '2026-01-27T...'\n}\n\n## Implementation\n1. Read events from log since timestamp\n2. Build summary of completed/stuck/started workers\n3. Return current counts\n\n## Dependencies\nUses events.py module and poller for state","priority":"1","title":"poll_worker_changes MCP tool","type":"task"}}
{"type":"status_update","timestamp":"2026-01-27T21:49:05.277437Z","issue_id":"cic-467","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-27T21:57:54.35541Z","issue_id":"cic-467","payload":{}}
{"type":"create","timestamp":"2026-01-27T22:25:57.608217Z","issue_id":"cic-c1b","payload":{"description":"The background poller emits worker_started on every snapshot cycle instead of just once when a worker first appears.\n\n## Observed\n- Yanni spawned once\n- 5x worker_started events in event log\n- poll_worker_changes summary shows Yanni 5x in 'started'\n\n## Expected\n- Single worker_started when worker first appears\n- Subsequent snapshots should NOT emit worker_started for same worker\n\n## Root Cause\nThe diff logic in poller.py isn't correctly tracking 'already seen' workers between snapshots. The previous_snapshot comparison may not be persisting correctly.\n\n## Related\ncic-9da (worker state tracking epic)","priority":"1","title":"Poller emits duplicate worker_started events","type":"bug"}}
{"type":"update","timestamp":"2026-01-27T22:29:47.773131Z","issue_id":"cic-c1b","payload":{"description":"The background poller's diff logic is fundamentally broken. Multiple issues:\n\n## Bugs\n\n### 1. Duplicate worker_started events\nEvery snapshot cycle emits worker_started for ALL workers, not just new ones.\n\n### 2. No worker_idle events  \nWhen a worker transitions to is_idle=true, no worker_idle event is emitted.\n\n### 3. Wrong event type\nWorkers with is_idle=true still get worker_started events instead of worker_idle.\n\n### 4. No worker_active events\nWhen a worker transitions from idle back to active, no event is emitted.\n\n## Root Cause\nThe poller isn't properly tracking previous state to detect transitions. It appears to emit worker_started for every worker present in each snapshot.\n\n## Expected Behavior\n1. Track previous snapshot's worker IDs and is_idle states\n2. New worker (not in previous) → worker_started\n3. is_idle: false → true → worker_idle\n4. is_idle: true → false → worker_active  \n5. Worker removed from registry → worker_closed\n6. Existing workers with same state → NO event\n\n## Files\n- src/claude_team/poller.py - _diff_snapshots method\n\n## Test Case\n```bash\n# Spawn worker\nmcporter call claude-team-http.spawn_workers workers='[{...}]'\n# Wait 10s, check events\ntail -10 ~/.claude-team/events.jsonl\n# Should see ONE worker_started, not multiple\n```"}}
{"type":"status_update","timestamp":"2026-01-27T22:30:21.430249Z","issue_id":"cic-c1b","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-27T22:33:26.969394Z","issue_id":"cic-c1b","payload":{}}
{"type":"status_update","timestamp":"2026-01-27T23:31:42.153326Z","issue_id":"cic-c1b","payload":{"status":"in_progress"}}
{"type":"comment","timestamp":"2026-01-27T23:32:24.386198Z","issue_id":"cic-c1b","payload":{"body":"## Root Cause Analysis\n\n**Problem:** Duplicate worker_started events (3x for Adele)\n\n**Root cause:** StreamableHTTP transport creates **per-session lifespan contexts**. Each HTTP request (mcporter call) enters app_lifespan(), which creates a NEW WorkerPoller with empty _last_snapshot. When multiple HTTP sessions are active simultaneously, each poller sees workers as 'new' and emits worker_started.\n\nEvidence from debug logs:\n- 'Connected to iTerm2 successfully' and 'Created global singleton registry' appear at multiple timestamps\n- 3 duplicate worker_started events at 23:01:48Z (x2) and 23:01:51Z (x1)\n- Timestamps align with spawn_workers call creating multiple HTTP sessions\n\n**Fix:** Make WorkerPoller a module-level singleton (like _global_registry):\n1. Add _global_poller: WorkerPoller | None = None at module level\n2. Add get_global_poller(registry) that creates once and returns existing\n3. In app_lifespan, use get_global_poller() instead of WorkerPoller()\n4. Guard poller.start() to be idempotent\n\nThe _last_snapshot must persist across HTTP sessions, not reset per-session."}}
{"type":"close","timestamp":"2026-01-27T23:36:10.476116Z","issue_id":"cic-c1b","payload":{}}
{"type":"status_update","timestamp":"2026-01-28T00:19:38.133642Z","issue_id":"cic-c1b","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-28T00:19:42.014781Z","issue_id":"cic-c1b","payload":{}}
{"type":"create","timestamp":"2026-01-28T00:37:49.638471Z","issue_id":"cic-f80","payload":{"description":"Change the poller's _build_snapshot() to use file mtime for idle detection instead of Stop hook detection.\n\n## Current Behavior\nIn src/claude_team/poller.py, _build_snapshot() calls session.is_idle() which uses Stop hook detection. This requires Claude Code's Stop hook to be configured, which workers may not have.\n\n## Required Change\nReplace:\n```python\nis_idle = session.is_idle()\n```\n\nWith:\n```python\nfrom claude_team.idle_detection import detect_worker_idle\nis_idle, _reason = detect_worker_idle(session, idle_threshold_seconds=300)\n```\n\n## Notes\n- detect_worker_idle() already exists in src/claude_team/idle_detection.py\n- It uses file mtime (JSONL for Claude, output file for Codex)\n- The Worker protocol may need adaptation - check that session object has required attributes (agent_type, project_path, claude_session_id)\n- Default threshold is 300 seconds (5 min)\n\n## Test\n1. Spawn a worker\n2. Wait 5+ minutes with no activity\n3. Check events.jsonl for worker_idle event","priority":"1","title":"Use file mtime for poller idle detection instead of Stop hooks","type":"task"}}
{"type":"status_update","timestamp":"2026-01-28T00:38:19.581186Z","issue_id":"cic-f80","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-28T00:40:01.15665Z","issue_id":"cic-f80","payload":{}}
{"type":"create","timestamp":"2026-01-28T01:12:32.699494Z","issue_id":"cic-b16","payload":{"description":"The events.jsonl file currently grows unbounded. Implement a log rotation policy.\n\n## Requirements\n- Daily rotation (roll over at midnight or on first write of new day)\n- Backup old log with timestamp (e.g., events.2026-01-27.jsonl)\n- New log should preserve events for:\n  - Currently active workers\n  - Most recently active workers (configurable threshold, e.g., last 24h)\n- Consider max file size trigger as secondary rotation condition\n\n## Implementation Ideas\n- Check date on each write, rotate if day changed\n- On rotation: read old file, filter to recent/active workers, write to new file\n- Move rest to timestamped backup\n- Could also implement max_events or max_size_mb thresholds\n\n## Files\n- src/claude_team/events.py - append_events, rotate_events_log","priority":"2","title":"Event log rotation policy","type":"task"}}
{"type":"close","timestamp":"2026-01-28T03:02:06.65654Z","issue_id":"cic-e18","payload":{}}
{"type":"status_update","timestamp":"2026-01-28T04:25:46.953814Z","issue_id":"cic-b16","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-28T04:34:55.6503Z","issue_id":"cic-b16","payload":{}}
||||||| Stash base
{"type":"create","timestamp":"2026-01-28T03:36:07.918938Z","issue_id":"cic-745","payload":{"description":"Introduce ~/.claude-team/config.json to replace growing number of env vars. Provides centralized configuration with versioning, auto-creation of defaults, and backwards-compatible env var overrides.","priority":"2","title":"System-wide config file (~/.claude-team/config.json)","type":"epic"}}
{"type":"create","timestamp":"2026-01-28T03:36:14.000096Z","issue_id":"cic-f41","payload":{"description":"Define dataclasses for config schema (ClaudeTeamConfig, CommandsConfig, DefaultsConfig, IssueTrackerConfig). Implement load_config() with JSON validation, handle missing file by creating defaults, implement version field for future migrations. Location: ~/.claude-team/config.json","priority":"2","title":"Create config module (src/claude_team_mcp/config.py)","type":"task"}}
{"type":"create","timestamp":"2026-01-28T03:36:26.885274Z","issue_id":"cic-cc8","payload":{"description":"Update cli_backends/claude.py and cli_backends/codex.py to use config module. Add get_claude_command() and get_codex_command() helpers that check env var first (for override), then config file, then built-in default. Maintains backwards compatibility.","priority":"2","title":"Update CLI backends to use config","type":"task"}}
{"type":"create","timestamp":"2026-01-28T03:36:28.068295Z","issue_id":"cic-1c1","payload":{"description":"Update tools/spawn_workers.py to read defaults from config: use_worktrees, agent_type, skip_permissions, layout. WorkerConfig values override config defaults. Explicit None in WorkerConfig means use config default.","priority":"2","title":"Update spawn_workers to use config defaults","type":"task"}}
{"type":"create","timestamp":"2026-01-28T03:36:29.305099Z","issue_id":"cic-8df","payload":{"description":"Update issue_tracker/__init__.py detect_issue_tracker() to check: 1) CLAUDE_TEAM_ISSUE_TRACKER env var, 2) config.issue_tracker.override, 3) marker directory detection. Implements the previously-documented but never-implemented env var.","priority":"2","title":"Implement issue_tracker.override in config","type":"task"}}
{"type":"create","timestamp":"2026-01-28T03:36:30.104901Z","issue_id":"cic-0a5","payload":{"description":"Add tests/test_config.py covering: config loading/saving, env var override precedence, auto-creation of default config when missing, JSON validation errors, version migration (future-proofing).","priority":"2","title":"Add tests for config module","type":"task"}}
{"type":"create","timestamp":"2026-01-28T03:36:30.872849Z","issue_id":"cic-f0a","payload":{"description":"Update README.md to document ~/.claude-team/config.json. Add example config. Document precedence (env var \u003e config \u003e default). Update Environment Variables section to note config file alternative.","priority":"3","title":"Update documentation for config file","type":"task"}}
{"type":"rename","timestamp":"2026-01-28T03:37:03.563993Z","issue_id":"cic-f41","payload":{"new_id":"cic-745.1"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:03.563999Z","issue_id":"cic-745.1","payload":{"dep_type":"parent-child","depends_on":"cic-745"}}
{"type":"rename","timestamp":"2026-01-28T03:37:03.614405Z","issue_id":"cic-cc8","payload":{"new_id":"cic-745.2"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:03.614411Z","issue_id":"cic-745.2","payload":{"dep_type":"parent-child","depends_on":"cic-745"}}
{"type":"rename","timestamp":"2026-01-28T03:37:03.671282Z","issue_id":"cic-1c1","payload":{"new_id":"cic-745.3"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:03.671289Z","issue_id":"cic-745.3","payload":{"dep_type":"parent-child","depends_on":"cic-745"}}
{"type":"rename","timestamp":"2026-01-28T03:37:03.728328Z","issue_id":"cic-8df","payload":{"new_id":"cic-745.4"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:03.728334Z","issue_id":"cic-745.4","payload":{"dep_type":"parent-child","depends_on":"cic-745"}}
{"type":"rename","timestamp":"2026-01-28T03:37:03.790408Z","issue_id":"cic-0a5","payload":{"new_id":"cic-745.5"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:03.790422Z","issue_id":"cic-745.5","payload":{"dep_type":"parent-child","depends_on":"cic-745"}}
{"type":"rename","timestamp":"2026-01-28T03:37:03.854379Z","issue_id":"cic-f0a","payload":{"new_id":"cic-745.6"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:03.854384Z","issue_id":"cic-745.6","payload":{"dep_type":"parent-child","depends_on":"cic-745"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.074548Z","issue_id":"cic-745.2","payload":{"dep_type":"blocks","depends_on":"cic-745.1"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.132494Z","issue_id":"cic-745.3","payload":{"dep_type":"blocks","depends_on":"cic-745.1"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.196907Z","issue_id":"cic-745.4","payload":{"dep_type":"blocks","depends_on":"cic-745.1"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.257668Z","issue_id":"cic-745.5","payload":{"dep_type":"blocks","depends_on":"cic-745.1"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.33493Z","issue_id":"cic-745.6","payload":{"dep_type":"blocks","depends_on":"cic-745.2"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.402761Z","issue_id":"cic-745.6","payload":{"dep_type":"blocks","depends_on":"cic-745.3"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.464015Z","issue_id":"cic-745.6","payload":{"dep_type":"blocks","depends_on":"cic-745.4"}}
{"type":"dep_add","timestamp":"2026-01-28T03:37:12.524492Z","issue_id":"cic-745.6","payload":{"dep_type":"blocks","depends_on":"cic-745.5"}}
{"type":"create","timestamp":"2026-01-28T05:13:26.217794Z","issue_id":"cic-e1b","payload":{"description":"Migrate CLAUDE_TEAM_EVENTS_MAX_SIZE_MB and CLAUDE_TEAM_EVENTS_RECENT_HOURS to config.json","priority":"2","title":"Add event rotation settings to config","type":"task"}}
{"type":"dep_add","timestamp":"2026-01-28T05:13:29.196306Z","issue_id":"cic-745","payload":{"dep_type":"blocks","depends_on":"cic-e1b"}}
